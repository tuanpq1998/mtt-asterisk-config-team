[internal]

exten => 777,1,NoOp("Conference User")
same => n,ConfBridge(1,default_bridge,default_user)

exten => 888,1,NoOp("Conference Admin")
same => n,ConfBridge(1,default_bridge,admin_user)

exten => 20172880,1,Answer()
exten => 20172880,2,Set(CALLFILENAME=${EXTEN:0}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => 20172880,3,Monitor(wav,${CALLFILENAME})
exten => 20172880,4,Dial(SIP/20172880,60)
exten => 20172880,5,Playback(vm-nobodyavail)
exten => 20172880,6,VoiceMail(20172880@main)
exten => 20172880,7,Hangup()

exten => 20172889,1,Answer()
exten => 20172889,2,Set(CALLFILENAME=${EXTEN:0}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => 20172889,3,Monitor(wav,${CALLFILENAME})
exten => 20172889,4,Dial(SIP/20172889,60)
exten => 20172889,5,Playback(vm-nobodyavail)
exten => 20172889,6,VoiceMail(20172889@main)
exten => 20172889,7,Hangup()

exten => 20172890,1,Answer()
exten => 20172890,2,Set(CALLFILENAME=${EXTEN:0}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => 20172890,3,Monitor(wav,${CALLFILENAME})
exten => 20172890,4,Dial(SIP/20172890,60)
exten => 20172890,5,Playback(vm-nobodyavail)
exten => 20172890,6,VoiceMail(20172890@main)
exten => 20172890,7,Hangup()

exten => 20164406,1,Answer()
exten => 20164406,2,Set(CALLFILENAME=${EXTEN:0}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => 20164406,3,Monitor(wav,${CALLFILENAME})
exten => 20164406,4,Dial(SIP/20164406,60)
exten => 20164406,5,Playback(vm-nobodyavail)
exten => 20164406,6,VoiceMail(20164406@main)
exten => 20164406,7,Hangup()

exten => 20173457,1,Answer()
exten => 20173457,2,Set(CALLFILENAME=${EXTEN:0}-${STRFTIME(${EPOCH},,%Y%m%d-%H%M%S)})
exten => 20173457,3,Monitor(wav,${CALLFILENAME})
exten => 20173457,4,Dial(SIP/20173457,60)
exten => 20173457,5,Playback(vm-nobodyavail)
exten => 20173457,6,VoiceMail(20173457@main)
exten => 20173457,7,Hangup()

exten => 8001,1,VoicemailMain(20172880@main)
exten => 8001,2,Hangup()

exten => 8002,1,VoicemailMain(20172889@main)
exten => 8002,2,Hangup()

exten => 8003,1,VoicemailMain(20172890@main)
exten => 8003,2,Hangup()

exten => 8004,1,VoicemailMain(20164406@main)
exten => 8004,2,Hangup()

exten => 8005,1,VoicemailMain(20173457@main)
exten => 8005,2,Hangup()

[messgcontext]
exten => _.,1,NoOp(SMS receiving dialplan invoked)
exten => _.,n,NoOp(To ${MESSAGE(to)})
exten => _.,n,NoOp(From ${MESSAGE(from)})
exten => _.,n,NoOp(Body ${MESSAGE(body)})
;exten => _.,n,AGI(chatplan.php,${MESSAGE(from)})
exten => _.,n,Set(ACTUALTO=${CUT(MESSAGE(to),@,1)})
exten => _.,n,ExecIf($["${ACTUALTO}" != "sip:${EXTEN}"]?Set(ACTUALTO=sip:${EXTEN}))
exten => _.,n,MessageSend(${ACTUALTO},${MESSAGE(from)})
exten => _.,n,NoOp(Send status is ${MESSAGE_SEND_STATUS})
exten => _.,n,GotoIf($["${MESSAGE_SEND_STATUS}" != "SUCCESS"]?sendfailedmsg)
exten => _.,n,Hangup()
;; Handle failed messaging
exten => _.,n(sendfailedmsg),NoOp(Sending error to user)
exten => _.,n,Set(SRC=${MESSAGE(from)})
exten => _.,n,Set(DST=${MESSAGE(to)})
exten => _.,n,Set(MSG=${MESSAGE(body)})
exten => _.,n,Set(MESSAGE(body)="[${STRFTIME(${EPOCH},,%d%m%Y-%H:%M:%S)}] Your message to ${EXTEN} has failed. Sending when available")
exten => _.,n,Set(ME_1=${CUT(MESSAGE(from),<,2)})
exten => _.,n,Set(ACTUALFROM=${CUT(ME_1,@,1)})
exten => _.,n,MessageSend(${ACTUALFROM},ServiceCenter)
;exten => _.,n,GotoIf($["${INQUEUE}" != "1"]?startq)
exten => _.,n,Hangup()
